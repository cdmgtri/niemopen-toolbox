import{e as j,r as g,q as _,s as J,v as W,x as h,o as C,c as $,b as i,w as n,h as t,F as z,a as m,d,y as K,j as q,p as Q,l as Y}from"./B4LEY2OC.js";import{_ as Z,a as ee,b as oe}from"./D5M2G_Rh.js";import{_ as te}from"./D5YiijYX.js";import{_ as le,a as ie,b as ne}from"./UQDTExFp.js";import{_ as ae}from"./V5w1dLgF.js";import{_ as u,A as se}from"./DsPweMlB.js";import{A as f,a as s,T as re,_ as w}from"./B7lAAY5O.js";import"./DnOhiAXk.js";import"./6bm_RRcn.js";import"./CgmagM3f.js";import"./wVOZ42FT.js";import"./CcQyslrq.js";import"./Qy7vSWk7.js";import"./CKRfikd8.js";import"./C0e8eNHv.js";import"./Cpj98o6Y.js";const me={class:"font-medium"},ue={key:0},pe={key:1},Ne=j({__name:"migrate",setup(de){const a=g("upload"),E=[{value:"upload",icon:u.upload,label:"Upload"},{type:"separator"},{type:"label",label:"Demo files"},{value:"valid",icon:u.success,label:"Valid",path:"demo/migrate/CrashDriver-NIEM-5.0.cmf.xml"},{value:"invalid",icon:u.error,label:"Invalid",path:"demo/migrate/CrashDriver-NIEM-5.0-v0.6.cmf.xml"}],I=_(()=>E.find(e=>e.value==a.value)),c=g();J(a,async(e,o)=>{var r;I.value&&a.value!="upload"?(l.file=await s.loadPublicFile(I.value.path),c.value=(r=l.file)==null?void 0:r.name,l.from="5.0"):(l.file=void 0,l.from=void 0)});const l=W({}),b=["1.0","2.0","2.1","3.0","3.1","3.2","4.0","4.1","4.2","5.0","5.1","5.2"],R=g(b.slice(0,-1)),S=_(()=>l.from!=null?b.slice(1).filter(e=>e>(l.from||"")):b.slice(1));function A(e){F.value="",l.file=s.fileInput(e),v.request="unsent"}const P=_(()=>{var e;return`curl -i -X POST -H "Content-Type: multipart/form-data" -F from=${l.from} -F to=${l.to} -F file=@${(e=l.file)==null?void 0:e.name} ${f.routes.migrate}`}),N=h("form"),F=g(""),k=_(()=>{var e;return re.extension((e=l.file)==null?void 0:e.name)});let U=!1;function B(e){const o=s.initFormErrors();return F.value=void 0,s.validateRequiredField(o,"from",e.from),s.validateRequiredField(o,"to",e.to),U&&(s.validateRequiredField(o,"file",e.file),s.validateFileExtension(o,"file",["cmf","xml","cmf.xml"],k.value)),o}const v=f.initResults();async function D(){var r;if(console.log("Sending migration request",l.from,l.to,l.file),U=!0,await((r=N.value)==null?void 0:r.validate())==!1)return;const o=await f.post(f.routes.migrate,l,v);await f.downloadFileResults(o,v),U=!1}return(e,o)=>{const r=Q,L=ee,O=te,T=le,M=ie,V=ne,X=Y,x=oe,G=ae,H=Z;return C(),$(z,null,[i(O,{page:("AppItems"in e?e.AppItems:t(se)).migrate},{user:n(()=>[o[7]||(o[7]=m("p",null," Migrate a NIEM subset to a more recent version of NIEM. ",-1)),m("p",me,[o[5]||(o[5]=d("Use the ")),i(r,{to:"/transform"},{default:n(()=>o[4]||(o[4]=[d("Transform")])),_:1}),o[6]||(o[6]=d(" feature to:"))]),o[8]||(o[8]=m("ul",{class:"bullets"},[m("li",null,"Convert existing NIEM XML schemas to CMF if needed for the migration."),m("li",null,"Convert the migration output to NIEM XML schemas, JSON schema, or another supported output format.")],-1)),o[9]||(o[9]=m("p",null,"Note that multi-step migration is possible in a single request. Any migration issues between versions will be aggregated into a single results file.",-1)),o[10]||(o[10]=m("br",null,null,-1))]),developer:n(()=>[i(L,{title:"POST request",code:t(P)},null,8,["code"])]),_:1},8,["page"]),i(G,null,{default:n(()=>[i(x,{ref_key:"form",ref:N,state:t(l),validate:B,"validate-on":["change"],onSubmit:K(D,["prevent"]),enctype:"multipart/form-data"},{default:n(()=>[i(V,{name:"file",required:"",error:t(F),label:"1. Select a CMF file to migrate (NIEM subsets only)",help:("ToolboxForm"in e?e.ToolboxForm:t(s)).fileWarning(t(a)=="upload")},{default:n(()=>{var p;return[t(a)=="upload"?(C(),$("span",ue,[i(T,{type:"file",id:"uploadFileElement",onChange:A,accept:".cmf,.cmf.xml,.xml",icon:("icons"in e?e.icons:t(u)).upload,ui:("UI"in e?e.UI:t(w)).inputFileInGroup},{trailing:n(()=>o[11]||(o[11]=[d("(CMF)")])),_:1},8,["icon","ui"])])):(C(),$("span",pe,[i(T,{modelValue:t(c),"onUpdate:modelValue":o[0]||(o[0]=y=>q(c)?c.value=y:null),ui:("UI"in e?e.UI:t(w)).inputFileInGroup,icon:("icons"in e?e.icons:t(u)).magic},null,8,["modelValue","ui","icon"])])),i(M,{modelValue:t(a),"onUpdate:modelValue":o[1]||(o[1]=y=>q(a)?a.value=y:null),items:E,color:"neutral",variant:"subtle",ui:("UI"in e?e.UI:t(w)).inputMode,icon:(p=t(I))==null?void 0:p.icon},null,8,["modelValue","ui","icon"])]}),_:1},8,["error","help"]),i(V,{name:"from",required:"",label:"2. Select current version"},{default:n(()=>[i(M,{modelValue:t(l).from,"onUpdate:modelValue":o[2]||(o[2]=p=>t(l).from=p),items:t(R),icon:("icons"in e?e.icons:t(u)).start,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),i(V,{name:"to",required:"",label:"3. Select migration version"},{default:n(()=>[i(M,{modelValue:t(l).to,"onUpdate:modelValue":o[3]||(o[3]=p=>t(l).to=p),items:t(S),icon:("icons"in e?e.icons:t(u)).end,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),i(X,{type:"submit"},{default:n(()=>o[12]||(o[12]=[d("Migrate")])),_:1})]),_:1},8,["state"])]),_:1}),i(H,{results:t(v)},null,8,["results"])],64)}}});export{Ne as default};
//# sourceMappingURL=DxhT-gQY.js.map
