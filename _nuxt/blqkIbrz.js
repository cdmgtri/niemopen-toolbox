import{e as x,j as g,k as I,l as J,m as W,n as z,o as $,c as w,b as n,w as i,f as t,F as K,a as m,d as f,p as Q,q,i as Y,s as Z}from"./D0Pwa46T.js";import{A as p,T as s,a as h,_ as ee,b as y,c as oe,d as te,e as le,f as ne,g as ie}from"./CmEUE5nd.js";import{_ as ae,a as se}from"./CU3y2PMo.js";import{A as re,_ as u}from"./CyY6rk52.js";import"./DchWDw9J.js";import"./6bm_RRcn.js";import"./D2BnHQuX.js";import"./Cpj98o6Y.js";import"./C0e8eNHv.js";const me={class:"font-medium"},ue={key:0},de={key:1},Me=x({__name:"migrate",setup(fe){const a=g("upload"),E=[{value:"upload",icon:u.upload,label:"Upload"},{type:"separator"},{type:"label",label:"Demo files"},{value:"valid",icon:u.success,label:"Valid",path:"demo/migrate/CrashDriver-NIEM-5.0.cmf.xml"},{value:"invalid",icon:u.error,label:"Invalid",path:"demo/migrate/CrashDriver-NIEM-5.0-v0.6.cmf.xml"}],_=I(()=>E.find(e=>e.value==a.value)),c=g();J(a,async(e,o)=>{var r;_.value&&a.value!="upload"?(l.file=await s.loadPublicFile(_.value.path),c.value=(r=l.file)==null?void 0:r.name,l.from="5.0"):(l.file=void 0,l.from=void 0)});const l=W({}),b=["1.0","2.0","2.1","3.0","3.1","3.2","4.0","4.1","4.2","5.0","5.1","5.2"],R=g(b.slice(0,-1)),S=I(()=>l.from!=null?b.slice(1).filter(e=>e>(l.from||"")):b.slice(1));function A(e){F.value="",l.file=s.fileInput(e),v.request="unsent"}const P=I(()=>{var e;return`curl -i -X POST -H "Content-Type: multipart/form-data" -F from=${l.from} -F to=${l.to} -F file=@${(e=l.file)==null?void 0:e.name} ${p.routes.migrate}`}),N=z("form"),F=g(""),k=I(()=>{var e;return h.extension((e=l.file)==null?void 0:e.name)});let U=!1;function B(e){const o=s.initFormErrors();return F.value=void 0,s.validateRequiredField(o,"from",e.from),s.validateRequiredField(o,"to",e.to),U&&(s.validateRequiredField(o,"file",e.file),s.validateFileExtension(o,"file",["cmf","xml","cmf.xml"],k.value)),o}const v=p.initResults();async function D(){var r;if(console.log("Sending migration request",l.from,l.to,l.file),U=!0,await((r=N.value)==null?void 0:r.validate())==!1)return;const o=await p.post(p.routes.migrate,l,v);await p.downloadFileResults(o,v),U=!1}return(e,o)=>{const r=Y,L=oe,O=ae,T=te,M=le,V=ne,X=Z,G=ie,H=se,j=ee;return $(),w(K,null,[n(O,{page:("AppItems"in e?e.AppItems:t(re)).migrate},{user:i(()=>[o[7]||(o[7]=m("p",null," Migrate a NIEM subset to a more recent version of NIEM. ",-1)),m("p",me,[o[5]||(o[5]=f("Use the ")),n(r,{to:"/transform"},{default:i(()=>o[4]||(o[4]=[f("Transform")])),_:1}),o[6]||(o[6]=f(" feature to:"))]),o[8]||(o[8]=m("ul",{class:"bullets"},[m("li",null,"Convert existing NIEM XML schemas to CMF if needed for the migration."),m("li",null,"Convert the migration output to NIEM XML schemas, JSON schema, or another supported output format.")],-1)),o[9]||(o[9]=m("p",null,"Note that multi-step migration is possible in a single request. Any migration issues between versions will be aggregated into a single results file.",-1)),o[10]||(o[10]=m("br",null,null,-1))]),developer:i(()=>[n(L,{title:"POST request",code:t(P)},null,8,["code"])]),_:1},8,["page"]),n(H,null,{default:i(()=>[n(G,{ref_key:"form",ref:N,state:t(l),validate:B,"validate-on":["change"],onSubmit:Q(D,["prevent"]),enctype:"multipart/form-data"},{default:i(()=>[n(V,{name:"file",required:"",error:t(F),label:"1. Select a CMF file to migrate (NIEM subsets only)",help:("ToolboxForm"in e?e.ToolboxForm:t(s)).fileWarning(t(a)=="upload")},{default:i(()=>{var d;return[t(a)=="upload"?($(),w("span",ue,[n(T,{type:"file",id:"uploadFileElement",onChange:A,accept:".cmf,.cmf.xml,.xml",icon:("icons"in e?e.icons:t(u)).upload,ui:("UI"in e?e.UI:t(y)).inputFileInGroup},{trailing:i(()=>o[11]||(o[11]=[f("(CMF)")])),_:1},8,["icon","ui"])])):($(),w("span",de,[n(T,{modelValue:t(c),"onUpdate:modelValue":o[0]||(o[0]=C=>q(c)?c.value=C:null),ui:("UI"in e?e.UI:t(y)).inputFileInGroup,icon:("icons"in e?e.icons:t(u)).magic},null,8,["modelValue","ui","icon"])])),n(M,{modelValue:t(a),"onUpdate:modelValue":o[1]||(o[1]=C=>q(a)?a.value=C:null),items:E,color:"neutral",variant:"subtle",ui:("UI"in e?e.UI:t(y)).inputMode,icon:(d=t(_))==null?void 0:d.icon},null,8,["modelValue","ui","icon"])]}),_:1},8,["error","help"]),n(V,{name:"from",required:"",label:"2. Select current version"},{default:i(()=>[n(M,{modelValue:t(l).from,"onUpdate:modelValue":o[2]||(o[2]=d=>t(l).from=d),items:t(R),icon:("icons"in e?e.icons:t(u)).start,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),n(V,{name:"to",required:"",label:"3. Select migration version"},{default:i(()=>[n(M,{modelValue:t(l).to,"onUpdate:modelValue":o[3]||(o[3]=d=>t(l).to=d),items:t(S),icon:("icons"in e?e.icons:t(u)).end,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),n(X,{type:"submit"},{default:i(()=>o[12]||(o[12]=[f("Migrate")])),_:1})]),_:1},8,["state"])]),_:1}),n(j,{results:t(v)},null,8,["results"])],64)}}});export{Me as default};
