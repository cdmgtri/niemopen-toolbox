import{i as B,j as F,k as C,l as $,o as P,c as T,b as i,w as r,a as u,d as c,e as n,m as D,F as O,h as x,n as A}from"./BTOMz1uO.js";import{_ as L,a as X,b as j,c as H,d as z,e as J,f as G,g as K,F as Q}from"./EyXL7GQa.js";import{_ as W,a as Y}from"./NAbOXu9k.js";import{l as Z,i as w,b as M}from"./DEqQpGQK.js";import{v,i as h,g as ee}from"./CzGluIhe.js";import{_ as te}from"./DlAUqK2U.js";import"./DlRFgOQ9.js";import"./Cpj98o6Y.js";const oe={class:"font-medium"},se=B({__name:"migrate",setup(ne){const o=F({status:"unsent",category:"unsent",title:"",message:"",filename:"",time:""}),s=F({from:void 0,to:void 0,file:void 0}),p=["1.0","2.0","2.1","3.0","3.1","3.2","4.0","4.1","4.2","5.0","5.1","5.2"],k=C(p.slice(0,-1)),S=$(()=>{if(s.from!=null){let t=s.from;return p.slice(1).filter(e=>e>t||"")}else return p.slice(1)}),y=$(()=>{var t;return`curl -i -X POST -H "Content-Type: multipart/form-data" -F from=${s.from} -F to=${s.to} -F file=@${(t=s.file)==null?void 0:t.name} ${M.migrate}`}),g=C("");function I(t){const e=h();return v(e,"file",t.file),v(e,"from",t.from),v(e,"to",t.to),e}function N(t){var l,f;g.value="";const a=t.target.files;if(!a||a.length==0)return;switch(s.file=a[0],(f=(l=s.file.name)==null?void 0:l.split("."))==null?void 0:f.pop()){case"cmf":case"xml":break;default:g.value="Please select a valid CMF file (.cmf or .cmf.xml)";break}}async function q(){var a,d,l;console.log("Sending migration request",s.from,s.to,s.file);let t=Date.now();const e=await fetch(M.migrate,{body:ee(s),method:"post"});if(o.time=K(t),e.ok){const f=await e.blob(),m=e.headers.get("Content-Disposition");o.filename=(m==null?void 0:m.split("=")[1])||"migration-results.zip",Q.saveAs(f,o.filename),o.category="success",o.error=void 0,o.title="",o.message=`Downloaded ${o.filename}`,console.log("Request succeeded",o.filename)}else o.category="error",o.error=await e.json(),o.title=`ERROR ${(a=o.error)==null?void 0:a.status}: ${(d=o.error)==null?void 0:d.error}`,o.message=((l=o.error)==null?void 0:l.message.replaceAll(";",`

`))||"",console.log("Request failed");o.status="returned"}return(t,e)=>{const a=x,d=X,l=W,f=j,m=H,b=z,E=A,U=J,V=Y,R=G;return P(),T(O,null,[i(l,{link:("links"in t?t.links:n(Z)).migrate},{info:r(()=>[e[5]||(e[5]=u("p",null," Migrate a NIEM subset to a more recent version of NIEM. ",-1)),u("p",oe,[e[3]||(e[3]=c("Use the ")),i(a,{to:"/transform"},{default:r(()=>e[2]||(e[2]=[c("Transform")])),_:1}),e[4]||(e[4]=c(" feature to:"))]),e[6]||(e[6]=u("ul",{class:"bullets"},[u("li",null,"Convert existing NIEM XML schemas to CMF if needed for the migration."),u("li",null,"Convert the migration output to NIEM XML schemas, JSON schema, or another supported output format.")],-1)),e[7]||(e[7]=u("p",null,"Note that multi-step migration is possible in a single request. Any migration issues between versions will be aggregated into a single results file.",-1)),e[8]||(e[8]=u("br",null,null,-1))]),developer:r(()=>[i(d,{title:"POST request",code:n(y)},null,8,["code"])]),_:1},8,["link"]),i(V,null,{default:r(()=>[i(U,{state:n(s),validate:I,onSubmit:D(q,["prevent"]),enctype:"multipart/form-data"},{default:r(()=>[i(m,{name:"file",required:"",error:n(g),label:"1. Select a CMF file to migrate (NIEM subsets only)",help:"Do not upload sensitive or distribution-restricted files."},{default:r(()=>[i(f,{onChange:N,class:"w-[600px]"},{trailing:r(()=>e[9]||(e[9]=[c("(CMF)")])),_:1})]),_:1},8,["error"]),i(m,{name:"from",required:"",label:"2. Select current version"},{default:r(()=>[i(b,{modelValue:n(s).from,"onUpdate:modelValue":e[0]||(e[0]=_=>n(s).from=_),items:n(k),icon:("icons"in t?t.icons:n(w)).start,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),i(m,{name:"to",required:"",label:"3. Select migration version"},{default:r(()=>[i(b,{modelValue:n(s).to,"onUpdate:modelValue":e[1]||(e[1]=_=>n(s).to=_),items:n(S),icon:("icons"in t?t.icons:n(w)).end,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),i(E,{type:"submit",ui:("ui"in t?t.ui:n(L)).button_default},{default:r(()=>e[10]||(e[10]=[c("Migrate")])),_:1},8,["ui"])]),_:1},8,["state"])]),_:1}),i(R,{results:n(o)},null,8,["results"])],64)}}}),ce=te(se,[["__scopeId","data-v-22c0aaa9"]]);export{ce as default};
