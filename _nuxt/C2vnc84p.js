import{e as H,J as g,q as _,S as J,T as W,U as K,o as $,c as w,b as n,w as i,f as l,M as j,a as m,d as f,V as z,W as N,R as Q,K as Y}from"./CWQT1cTJ.js";import{A as p,T as s,a as Z,_ as h,b as ee,c as oe}from"./DlY8Zih8.js";import{_ as te}from"./Dbequ_sm.js";import{_ as le,a as ne,b as ie}from"./PT20ulrQ.js";import{_ as ae}from"./CvNyCD49.js";import{A as se}from"./D_BTO39A.js";import{_ as u}from"./CEzrgrCa.js";import"./B5UyGN4k.js";import"./n33wfxEN.js";import"./6bm_RRcn.js";import"./FvzNdf1L.js";import"./Cpj98o6Y.js";import"./C0e8eNHv.js";const re={class:"font-medium"},me={key:0},ue={key:1},$e=H({__name:"migrate",setup(de){const a=g("upload"),y=[{value:"upload",icon:u.upload,label:"Upload"},{type:"separator"},{type:"label",label:"Demo files"},{value:"valid",icon:u.success,label:"Valid",path:"demo/migrate/CrashDriver-NIEM-5.0.cmf.xml"},{value:"invalid",icon:u.error,label:"Invalid",path:"demo/migrate/CrashDriver-NIEM-5.0-v0.6.cmf.xml"}],b=_(()=>y.find(o=>o.value==a.value)),c=g();J(a,async(o,e)=>{var r;b.value&&a.value!="upload"?(t.file=await s.loadPublicFile(b.value.path),c.value=(r=t.file)==null?void 0:r.name,t.from="5.0"):(t.file=void 0,t.from=void 0)});const t=W({}),F=["1.0","2.0","2.1","3.0","3.1","3.2","4.0","4.1","4.2","5.0","5.1","5.2"],q=g(F.slice(0,-1)),R=_(()=>t.from!=null?F.slice(1).filter(o=>o>(t.from||"")):F.slice(1));function S(o){I.value="",t.file=s.fileInput(o),v.request="unsent"}const A=_(()=>{var o;return`curl -i -X POST -H "Content-Type: multipart/form-data" -F from=${t.from} -F to=${t.to} -F file=@${(o=t.file)==null?void 0:o.name} ${p.routes.migrate}`}),T=K("form"),I=g(""),P=_(()=>{var o;return Z.extension((o=t.file)==null?void 0:o.name)});let M=!1;function k(o){const e=s.initFormErrors();return I.value=void 0,s.validateRequiredField(e,"from",o.from),s.validateRequiredField(e,"to",o.to),M&&(s.validateRequiredField(e,"file",o.file),s.validateFileExtension(e,"file",["cmf","xml","cmf.xml"],P.value)),e}const v=p.initResults();async function x(){var r;if(console.log("Sending migration request",t.from,t.to,t.file),M=!0,await((r=T.value)==null?void 0:r.validate())==!1)return;const e=await p.post(p.routes.migrate,t,v);await p.downloadFileResults(e,v),M=!1}return(o,e)=>{const r=Q,B=ee,D=te,E=le,V=ne,U=ie,L=Y,O=oe,X=ae,G=h;return $(),w(j,null,[n(D,{page:("AppItems"in o?o.AppItems:l(se)).migrate},{user:i(()=>[e[7]||(e[7]=m("p",null," Migrate a NIEM subset to a more recent version of NIEM. ",-1)),m("p",re,[e[5]||(e[5]=f("Use the ")),n(r,{to:"/transform"},{default:i(()=>e[4]||(e[4]=[f("Transform")])),_:1}),e[6]||(e[6]=f(" feature to:"))]),e[8]||(e[8]=m("ul",{class:"bullets"},[m("li",null,"Convert existing NIEM XML schemas to CMF if needed for the migration."),m("li",null,"Convert the migration output to NIEM XML schemas, JSON schema, or another supported output format.")],-1)),e[9]||(e[9]=m("p",null,"Note that multi-step migration is possible in a single request. Any migration issues between versions will be aggregated into a single results file.",-1)),e[10]||(e[10]=m("br",null,null,-1))]),developer:i(()=>[n(B,{title:"POST request",code:l(A)},null,8,["code"])]),_:1},8,["page"]),n(X,null,{default:i(()=>[n(O,{ref_key:"form",ref:T,state:l(t),validate:k,"validate-on":["change"],onSubmit:z(x,["prevent"]),enctype:"multipart/form-data"},{default:i(()=>[n(U,{name:"file",required:"",error:l(I),label:"1. Select a CMF file to migrate (NIEM subsets only)",help:("ToolboxForm"in o?o.ToolboxForm:l(s)).fileWarning(l(a)=="upload")},{default:i(()=>{var d;return[l(a)=="upload"?($(),w("span",me,[n(E,{type:"file",id:"uploadFileElement",onChange:S,accept:".cmf,.cmf.xml,.xml",icon:("icons"in o?o.icons:l(u)).upload,ui:o.UI.inputFileInGroup},{trailing:i(()=>e[11]||(e[11]=[f("(CMF)")])),_:1},8,["icon","ui"])])):($(),w("span",ue,[n(E,{modelValue:l(c),"onUpdate:modelValue":e[0]||(e[0]=C=>N(c)?c.value=C:null),ui:o.UI.inputFileInGroup,icon:("icons"in o?o.icons:l(u)).magic},null,8,["modelValue","ui","icon"])])),n(V,{modelValue:l(a),"onUpdate:modelValue":e[1]||(e[1]=C=>N(a)?a.value=C:null),items:y,color:"neutral",variant:"subtle",ui:o.UI.inputMode,icon:(d=l(b))==null?void 0:d.icon},null,8,["modelValue","ui","icon"])]}),_:1},8,["error","help"]),n(U,{name:"from",required:"",label:"2. Select current version"},{default:i(()=>[n(V,{modelValue:l(t).from,"onUpdate:modelValue":e[2]||(e[2]=d=>l(t).from=d),items:l(q),icon:("icons"in o?o.icons:l(u)).start,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),n(U,{name:"to",required:"",label:"3. Select migration version"},{default:i(()=>[n(V,{modelValue:l(t).to,"onUpdate:modelValue":e[3]||(e[3]=d=>l(t).to=d),items:l(R),icon:("icons"in o?o.icons:l(u)).end,class:"w-64"},null,8,["modelValue","items","icon"])]),_:1}),n(L,{type:"submit"},{default:i(()=>e[12]||(e[12]=[f("Migrate")])),_:1})]),_:1},8,["state"])]),_:1}),n(G,{results:l(v)},null,8,["results"])],64)}}});export{$e as default};
